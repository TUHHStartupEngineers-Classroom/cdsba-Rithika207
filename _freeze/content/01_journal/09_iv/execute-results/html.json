{
  "hash": "acf54c21f87e89b668a6067ee63f0bdf",
  "result": {
    "markdown": "---\ntitle: \"Instrumental Variables\"\nauthor: \"Rithika Rao Dodda\"\nnumber-sections: false\n---\n\n\n# Assignment\n\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-1_748e85c0d16cea5f6f9ff19e50867045'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n#> ✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n#> ✔ purrr     1.0.2     \n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n#> \n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\n```\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-2_a0bb369d261753621753c5bcc7609618'}\n\n```{.r .cell-code}\n# Load the file\nrandom_encouragement <- readRDS(\"Causal_Data_Science_Data/rand_enc.rds\")\n# Create a Data Frame\ndf=data.frame(random_encouragement)\n```\n:::\n\n\n1. Plot DAG\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-3_cf10ce3a230f692e8623cbab8d8aa679'}\n\n```{.r .cell-code}\niv_expl <- dagify(\n  timeSpent ~ used_ftr,\n  timeSpent ~ Unobserved_Characteristics,\n  used_ftr ~ Unobserved_Characteristics,\n  used_ftr ~ rand_enc,\n  coords = list(x = c(Unobserved_Characteristics = 1, used_ftr = 0, timeSpent = 2, rand_enc = -1),\n                y = c(Unobserved_Characteristics = 1, used_ftr = 0, timeSpent = 0, rand_enc = 0))\n)\n\nggdag(iv_expl, use_labels = \"name\", text = F) + theme_dag()\n```\n\n::: {.cell-output-display}\n![](09_iv_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nFrom my understanding of these relationships from DAG, time spent would be the outcome which depends on the used new feature (used_ftr) would be the treatment variable and randomized encouragement trial (rand_enc) would be instrumental variable. Unobserved Characteristics would effect the time spent and used new feature as it is unobserved we will not use further. \n\n2. Compute the naive, biased estimate.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-4_bef2bd184c7e4d564a4518faf151e30c'}\n\n```{.r .cell-code}\nmodel_biased <- lm(time_spent ~ used_ftr, data = df)\nsummary(model_biased)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = time_spent ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -20.4950  -3.5393   0.0158   3.5961  20.5051 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 18.86993    0.06955   271.3   <2e-16 ***\n#> used_ftr    10.82269    0.10888    99.4   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 5.351 on 9998 degrees of freedom\n#> Multiple R-squared:  0.497,\tAdjusted R-squared:  0.497 \n#> F-statistic:  9881 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-5_14ae8dfafb2c1d0b4e0ea6663e597ff5'}\n\n```{.r .cell-code}\nmodel_naive <- lm(rand_enc ~ used_ftr, data = df)\nsummary(model_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = rand_enc ~ used_ftr, data = df)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -0.6299 -0.4220  0.3701  0.3701  0.5780 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept) 0.421959   0.006361   66.33   <2e-16 ***\n#> used_ftr    0.207943   0.009959   20.88   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 0.4894 on 9998 degrees of freedom\n#> Multiple R-squared:  0.04178,\tAdjusted R-squared:  0.04169 \n#> F-statistic:   436 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n3.\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-6_2ec47869a6c167fe22b03fd2a8621d7b'}\n\n```{.r .cell-code}\ncor(df) %>% round(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#>            rand_enc used_ftr time_spent\n#> rand_enc       1.00     0.20       0.13\n#> used_ftr       0.20     1.00       0.71\n#> time_spent     0.13     0.71       1.00\n```\n:::\n:::\n\nOn computing the correlation the assumptions are verified \n* Random Assignment: The low correlation between rand_enc and other variables supports the effectiveness of random assignment.\n* Exclusion Restriction: The relatively low correlation between rand_enc and time_spent indicates that there may not be strong confounding factors, supporting the exclusion restriction to some extent.\n* Relevance of the Instrument: The positive correlation between rand_enc and used_ftr supports the relevance of the instrument.\n\nConsidering these results, instrumental variable estimation seems to be a reasonable approach in this scenario.\n\n4. Compute the IV estimate using 2SLS and compare it to the naive estimate\n\n::: {.cell hash='09_iv_cache/html/unnamed-chunk-7_6a55524a62def422b4c8a3a37b41957f'}\n\n```{.r .cell-code}\nlibrary(estimatr)\nmodel_iv <- iv_robust(time_spent ~ used_ftr | rand_enc, data = df)\nsummary(model_iv)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> iv_robust(formula = time_spent ~ used_ftr | rand_enc, data = df)\n#> \n#> Standard error type:  HC2 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value  Pr(>|t|) CI Lower CI Upper   DF\n#> (Intercept)   19.312     0.2248   85.89 0.000e+00   18.872    19.75 9998\n#> used_ftr       9.738     0.5353   18.19 8.716e-73    8.689    10.79 9998\n#> \n#> Multiple R-squared:  0.4921 ,\tAdjusted R-squared:  0.492 \n#> F-statistic:   331 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\nOn Computing the IV estimate using 2SLS and comparing it to the naive estimate, If the IV estimate is substantially different from the naive estimate, it indicates potential bias in the naive estimate. In this case, the naive estimate for used_ftr (0.207943) seems to be biased downward.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}